<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{{ url_for('static', filename='images/tandia_icon.png') }}" type="image/x-icon">
  <title>Soporte Mensual</title>
</head>

<body>
  {% include 'operaciones/headerSupport.html' %}

  <div class="header">
    <form id="search-form" method="POST" action="/follow_up">
      <input type="text" id="search-input" name="ruc" placeholder="Buscar por RUC...">
      <button type="submit">Buscar</button>
    </form>
    <button type="button" id="uploadButton">Nuevo Registro</button>
  </div>

  <div class="table-container">
    <table class="clientes">
      <thead>
        <tr>
          <th style="display:none;">ID</th>
          <th>Mes</th>
          <th>Año</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for list in list %}
        <tr>
          <td style="display:none;">{{ list[0] }}</td>
          <td>{{ list[1] }}</td>
          <td>{{ list[2] }}</td>

          {% if list[3] == 'EN PROCESO' %}
          <td><a class="orange-proces"> EN PROCESO </a></td>
          {% else %}
          <td class="green-true"> FINALIZADO </td>
          {% endif %}


          <th><a href="{{ url_for('operaciones.detail_MonthlyS', register_id=list[0]) }}" target="_blank"><i
                class="fa-solid fa-circle-info"></i>
              <a class="active-button"><i class="fa-solid fa-check"></i></a></th>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">
      <button id="prevPage"><i class="fa-solid fa-backward"></i></button>
      <button id="prevPageNumber">0</button>
      <button id="currentPage">1</button>
      <button id="nextPageNumber">2</button>
      <button id="nextPage"><i class="fa-solid fa-forward"></i></button>
    </div>
  </div>

  <div id="uploadPopup" class="popup" style="display: none;">
    <div class="popup-content">
      <span class="close-button" id="close-upload-popup">&times;</span>
      <h2>Cargar Archivo Excel</h2>

      <!-- Form for uploading the Excel file -->
      <form method="post" action="/upload_inactive_tracking" enctype="multipart/form-data">
        <div class="input-container">
          <label class="label-overlay" for="excelFile">Seleccionar archivo Excel</label>
          <input class="styled-input" type="file" name="excelFile" id="excelFile" accept=".xls, .xlsx" required>
        </div>

        <button class="styled-input styled-button-popUp" type="submit" id="uploadFileButton">Cargar</button>
      </form>
    </div>
  </div>

  <div id="active-popup" class="popup">
    <div class="popup-content">
      <h2>Confirmación</h2>
      <p>Finalizar Registro Mensual</p>

      <form method="post" action="/endMonthlySupport" autocomplete="off">
        <input type="hidden" id="monthlySupport_id" name="monthlySupport_id" value="">
        <button type="submit" class="styled-input styled-accept-popUp" id="confirm-active">Aceptar</button>
      </form>
      
      <button class="styled-input styled-cancel-popUp" id="active-cancel">Cancelar</button>
    </div>
  </div>

  

  <script>
    // ... (your existing code)

    // Add a new event listener for the "Nuevo Seguimiento" button
    const uploadButton = document.getElementById('uploadButton');
    const uploadPopup = document.getElementById('uploadPopup');
    const closeUploadPopupButton = document.getElementById('close-upload-popup');

    uploadButton.addEventListener('click', () => {
      uploadPopup.style.display = 'block';
    });

    closeUploadPopupButton.addEventListener('click', () => {
      uploadPopup.style.display = 'none';
    });
  </script>

<script>
  const activeButton = document.querySelectorAll('.active-button');
  const activePopup = document.getElementById('active-popup');
  const confirmActiveButton = document.getElementById('confirm-active');
  const activeCancelButton = document.getElementById('active-cancel');
  const monthlySupport_idInput = document.getElementById('monthlySupport_id');

  activeButton.forEach(button => {
    button.addEventListener('click', () => {
      activePopup.style.display = 'block';
      const monthlySupport_id = button.parentElement.parentElement.querySelector('td:nth-child(1)').textContent;
      monthlySupport_idInput.value = monthlySupport_id; // Asigna el valor del RUC a 'ruc_C' input
      console.log('Valor del campo id_followInput:', monthlySupport_idInput.value);
    });
  });

  activeCancelButton.addEventListener('click', () => {
    activePopup.style.display = 'none';
  });
</script>

  {% include 'operaciones/footer.html' %}

</body>

</html>
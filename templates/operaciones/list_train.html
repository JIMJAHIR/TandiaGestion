<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{{ url_for('static', filename='images/tandia_icon.png') }}" type="image/x-icon">
  <title>Capacitaciones</title>
</head>

<body>
  {% include 'operaciones/headerSupport.html' %}

  <div class="header">
    <form id="search-form" method="POST" action="/follow_up">
      <input type="text" id="search-input" name="ruc" placeholder="Buscar por RUC...">
      <button type="submit">Buscar</button>
    </form>
    <button type="button" class="newTrain" id="newTrain">Agendar Capacitación</button>
  </div>

  <div class="table-container">

    <table class="clientes">
      <thead>
        <tr>
          <th style="display:none;">ID</th>
          <th>Ruc</th>
          <th>Contrato</th>
          <th>Responsable</th>
          <th>Enlace</th>
          <th>Día</th>
          <th>Hora</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>

        {% for train in list_train|sort(reverse=True, attribute='6') %}
        <tr>
          <td style="display:none;">{{ train[0] }}</td>
          <td>{{ train[3] }}</td>
          <td>{{ train[4] }}</td>
          <td>{{ train[12] }}</td>
          <td>{{ train[5] }}</td>
          <td>{{ train[6] }}</td>
          <td>{{ train[7] }}</td>

          {% if train[8] == 'AGENDADA' %}
          <td><a class="act-button orange-proces"> EN PROCESO </a></td>
          {% else %}
          <td class="green-true"> FINALIZADO </td>
          {% endif %}



        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">
      <button id="prevPage"><i class="fa-solid fa-backward"></i></button>
      <button id="prevPageNumber">0</button>
      <button id="currentPage">1</button>
      <button id="nextPageNumber">2</button>
      <button id="nextPage"><i class="fa-solid fa-forward"></i></button>
    </div>
  </div>

  <div id="act-popup" class="popup">
    <div class="popup-content">
      <h2>Confirmación</h2>
      <p>¿CAPACITACION REALIZADA</p>

      <form method="post" action="/acceptTrain" autocomplete="off">
        <input type="hidden" id="ruc" name="ruc" value="">
        <input type="hidden" id="train_id" name="train_id" value="">
        <button type="submit" class="styled-input styled-accept-popUp" id="confirm-accept">Aceptar</button>
      </form>

      <button class="styled-input styled-cancel-popUp" id="confirm-cancel">Cancelar</button>
    </div>
  </div>

  <div id="popup" class="popup">
    <div class="popup-content">
      <span class="close-button" id="close-popup">&times;</span>
      <h2>Capacitación</h2>

      <form method="post" action="/newTrain" autocomplete="off">

        <div class="input-container">
          <label class="label-overlay" for="ruc">Ruc</label>
          <input class="styled-input" type="text" name="ruc" id="ruc" required>
        </div>
        <div class="input-container">
          <label class="label-overlay" for="contract_number">Contrato</label>
          <input class="styled-input" type="text" name="contract_number" id="contract_number" required>
        </div>
        <div class="input-container">
          <label class="label-overlay" for="url_train">Enlace Capacitación</label>
          <input class="styled-input" type="text" name="url_train" id="url_train" required>
        </div>
        <div class="input-container input-container2">
          <label class="label-overlay" for="date_train">Fecha</label>
          <input class="styled-input" type="date" name="date_train" id="date_train" required>
        </div>

        <div class="newInput-container input-container2">
          <label class="label-overlay" for="hour_train">Hora</label>
          <select class="styled-input" name="hour_train" id="hour_train">
            <option value="11:00:00">11:00 am</option>
            <option value="16:00:00">04:00 pm</option>
          </select>
        </div>

        <div class="input-container">
          <label class="label-overlay" for="user_id_resp">Responsable</label>
          <select class="styled-input" name="user_id_resp" id="user_id_resp">
            {% for user in users %}
            <option value="{{user.0}}">{{user.3}}</option>
            {% endfor %}
          </select>
        </div>
        <button class="styled-input styled-button-popUp" type="submit" id="registrar-button">Registrar</button>

      </form>
    </div>
  </div>


  <script>
    const actButton = document.querySelectorAll('.act-button');
    const actPopup = document.getElementById('act-popup');
    const confirmAcceptButton = document.getElementById('confirm-accept');
    const confirmCancelButton = document.getElementById('confirm-cancel');
    const trainIdInput = document.getElementById('train_id');
    const rucInput = document.getElementById('ruc');

    actButton.forEach(button => {
      button.addEventListener('click', () => {
        actPopup.style.display = 'block';
        const id = button.parentElement.parentElement.querySelector('td:nth-child(1)').textContent;
        trainIdInput.value = id;
        const ruc = button.parentElement.parentElement.querySelector('td:nth-child(2)').textContent;
        rucInput.value = ruc;
        console.log('Valor del campo ID:', trainIdInput.value);
        console.log('Valor del campo ruc:', rucInput.value);
      });
    });

    confirmCancelButton.addEventListener('click', () => {
      actPopup.style.display = 'none';
    });
  </script>

  <script>
    const registrarButtons = document.querySelectorAll('.newTrain'); // Selecciona los botones con la clase registrar-button
    const popup = document.getElementById('popup');
    const closePopupButton = document.getElementById('close-popup');

    registrarButtons.forEach((button, index) => {
      button.addEventListener('click', () => {
        popup.style.display = 'block';
      });
    });

    closePopupButton.addEventListener('click', () => {
      popup.style.display = 'none';
    });
  </script>

  {% include 'operaciones/footer.html' %}
</body>

</html>